<div class="dash-tab-form">
    <div class="row">
        <div class="col-sm-2 col-xs-12">
            <div class="form-group">
                <select id="severitySearch" class="form-control custom-select"
                    [value]="getColumnFilterValue('Severity')"
                    (change)="filterColumn('Severity', $event.target.value,'severitySearch')">
                    <option value="ALL" selected>- All -</option>
                    <option value="CRITICAL">CRITICAL</option>
                    <option value="HIGH">HIGH</option>
                    <option value="MEDIUM">MEDIUM</option>
                    <option value="LOW">LOW</option>
                    <option value="INFO">INFO</option>
                </select>
            </div>
        </div>

        <div class="col-sm-3 col-xs-12">
            <div class="form-group">
                <input id="vulSearch" type="text" placeholder="Vulnerability" name="search-name" class="form-control"
                    (input)="filterColumn('Vulnerability', $event.target.value,'vulSearch')"
                    [value]="getColumnFilterValue('Vulnerability')" />
            </div>
        </div>

        <div class="col-sm-3 col-xs-12">
            <div class="form-group">
                <input id="cweSearch" type="text" placeholder="CWE" name="search-name" class="form-control"
                    (input)="filterColumn('Cwe', $event.target.value,'cweSearch')"
                    [value]="getColumnFilterValue('Cwe')" />
            </div>
        </div>
    </div>
</div>

<div class="text-center center-table-progressbar" *ngIf="isDisablePaggination">
    <mat-progress-spinner strokeWidth="5" [diameter]="40" [mode]="'indeterminate'">
    </mat-progress-spinner>
</div>

<div *ngIf="!isDisablePaggination" class="vulnerabilites-data">
    <ul>
        <li *ngFor="let vulData of vulnerabilitiesDetails.scan.vulnerabilities.edges"
            class="data-item {{vulData?.node?.severity}}">

            <div class="row">
                <div class="col-sm-10 col-xs-12">
                    <div class="vulner-data-lt">
                        <div (click)="gotoDetails(vulData?.node?.vulnerabilityId)" class="cursor-pointer">
                            <div class="data-tag-ttl">
                                <h3>
                                    <span [ngClass]="{'hidden' : vulData?.node?.severity != 'NONE'}"
                                        class="badge m-r-5 badge-light-info">{{vulData?.node?.severity}}</span>
                                    <span [ngClass]="{'hidden' : vulData?.node?.severity !== 'LOW'}"
                                        class="badge m-r-5 badge-light-primary">{{vulData?.node?.severity}}</span>
                                    <span [ngClass]="{'hidden' : vulData?.node?.severity !== 'MEDIUM'}"
                                        class="badge m-r-5 badge-light-warning">{{vulData?.node?.severity}}</span>
                                    <span [ngClass]="{'hidden' : vulData?.node?.severity !== 'HIGH'}"
                                        class="badge m-r-5 badge-light-danger">{{vulData?.node?.severity}}</span>
                                    <span [ngClass]="{'hidden' : vulData?.node?.severity !== 'CRITICAL'}"
                                        class="badge m-r-5 badge-light-danger">{{vulData?.node?.severity}}</span>
                                    <span class="badge m-r-5 badge-light-primary">{{vulData?.node?.source}}</span>
                                </h3>
                                <span class="data-code ml-2"> {{vulData?.node?.vulnId}}</span>
                                <p class="data-hdng" *ngIf="vulData?.node?.components?.edges.length >= 1">
                                    {{getComponentName(vulData?.node?.components?.edges[0])}}</p>
                                &nbsp;<span *ngIf="vulData?.node?.components?.edges.length >= 2"
                                    triggers="mouseenter:mouseleave" [ngbPopover]="popContent"
                                    popoverClass="my-custom-class" class="text-primary cursor-pointer">more...</span>
                                <ng-template #popContent>
                                    <p *ngFor="let data of vulData?.node?.components?.edges">
                                        {{getComponentName(data)}}</p>
                                </ng-template>
                            </div>
                            <div class="data-row">
                                <h5>
                                    <label *ngIf="!!vulData?.node?.cwe?.cweId"
                                        class="data-tag purple-tag mr-2">CWE-{{vulData?.node?.cwe?.cweId}}</label>
                                </h5>
                                <p>{{vulData?.node?.cwe?.name}}</p>
                            </div>

                            <div class="data-row">
                                <div class="info-cols mr-5">
                                    <small>CVSS2:</small> {{vulData?.node?.cvssV2BaseScore}}
                                </div>

                                <div class="info-cols mr-5">
                                    <small>CVSS3:</small> {{vulData?.node?.cvssV3BaseScore}}
                                </div>

                                <div class="info-cols mr-5">
                                    <small>Published:</small>{{vulData?.node?.published | date}}
                                </div>

                                <div *ngIf="vulData?.node?.updated" class="info-cols mr-5">
                                    <small>Updated:</small>{{vulData?.node?.updated | date}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-2 col-xs-12">
                    <div class="vulner-data-rt">
                        <div class="info-cols" style="color: rgba(255, 255, 255, .2);">
                            <small style="color: rgba(255, 255, 255, .2);">Fixed Versions</small> 2.9.9.1, 2.8.11.4, 2.7.9.6
                        </div>

                        <div class="action-btns mt-2">
                            <a class="data-cta ingore-cta">Ignore</a>
                            <a *ngIf="vulData?.node?.components?.edges.length >= 1"
                                (click)="fixVersion(vulData?.node?.components?.edges[0].node.componentId,vulData?.node?.components?.edges[0].node.version)"
                                class="data-cta ml-2">Fix</a>
                        </div>
                    </div>
                </div>
            </div>

        </li>
    </ul>
</div>

<div class="col-sm-12">
    <mat-paginator [hidePageSize]="false" [disabled]="isDisablePaggination"
        [length]="vulnerabilitiesDetails.scan.vulnerabilities?.totalCount" [pageSize]="defaultPageSize"
        [pageSizeOptions]="[25, 50, 100]" (page)="changePage($event)">
    </mat-paginator>
</div>
