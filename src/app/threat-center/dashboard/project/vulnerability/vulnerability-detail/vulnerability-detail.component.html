
<div *ngIf='obsVulnerability | async as vulnerability; '>
  <div class="row" style="margin-bottom:20px">
    <div class="col-md-3" *ngIf='this.stateService.obsProject | async as project;'>
      <span style="font-size:15px"><a [routerLink]="['/dashboard/entity']">Team 1</a> / <a (click)="gotoProject()">{{project.name}}</a> / {{vulnerability.vulnId}}</span>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3>
        <span class="badge m-r-5 badge-light-primary">{{vulnerability.source}}</span>
        <span [ngClass]="{'hidden' : vulnerability.severity != 'NONE'}" class="badge m-r-5 badge-light-info">{{vulnerability.severity}}</span>
        <span [ngClass]="{'hidden' : vulnerability.severity !== 'LOW'}" class="badge m-r-5 badge-light-primary ">{{vulnerability.severity}}</span>
        <span [ngClass]="{'hidden' : vulnerability.severity !== 'MEDIUM'}" class="badge m-r-5 badge-light-warning ">{{vulnerability.severity}}</span>
        <span [ngClass]="{'hidden' : vulnerability.severity !== 'HIGH'}" class="badge m-r-5 badge-light-danger ">{{vulnerability.severity}}</span>
        <span [ngClass]="{'hidden' : vulnerability.severity !== 'CRITICAL'}" class="badge m-r-5 badge-light-danger ">{{vulnerability.severity}}</span>
        {{vulnerability.vulnId}}
      </h3>
      Published: <span title="Info" class="badge m-r-5 badge-light-primary">{{vulnerability.published  | date :'MMMM d, y h:mm'}}</span>
      Updated: <span title="Info" class="badge m-r-5 badge-light-primary">{{vulnerability.updated | date :'MMMM d, y h:mm'}}</span>
    </div>
  </div>

  <div class="row m-t-50">
    <div class="col-md-12">
      <ngb-tabset type="pills" [activeId]="stateService.vulnerability_tabs_selectedTab" (tabChange)="onTabChange($event)">

        <!-- DETAILS TAB -->
        <ngb-tab title="Details" id="details">
          <ng-template ngbTabContent>

            <!-- CWE -->
            <div style="display: flex;">
              <div class="card m-3" style="flex: 40%;" *ngIf="vulnerability.cwe">
                <div class="card-body" >
                  <h5 class="card-title">
                    <span class="badge m-r-10 badge-light-primary">CWE-{{vulnerability.cwe.cweId}}</span>
                    <a href="https://cwe.mitre.org/data/definitions/{{vulnerability.cwe.cweId}}.html">{{vulnerability.cwe.name}}</a>
                  </h5>
                </div>
              </div>
            </div>

            <div style="display: flex;">

              <div class="card m-3" style="flex: 45%;">
                <div class="card-body">
                  <h5 class="card-title">Description</h5>
                  <p class="card-text">{{vulnerability.description}}</p>
                  <!--<p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>-->
                </div>
              </div>

              <div class="card m-3" style="flex: 55%;">
                <div class="card-body">
                  <h5 class="card-title"><span title="Critical" class="badge m-r-5 badge-light-success">SAST VECTOR META DATA</span></h5>

                  <form class="m-t-20">
                    <div class="form-group row ">
                      <label for="file" class="col-sm-3 col-form-label">File</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" id="file" readonly placeholder="http.conn.ssl.SSLConnectionSocketFactory.java">
                      </div>
                    </div>
                    <div class="form-group row">
                      <label for="method" class="col-sm-3 col-form-label">Method</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" id="method" readonly placeholder="private http.conn.ssl.SSLConnection getConnection(http.conn.ssl.SSLRequest)">
                      </div>
                    </div>
                    <div class="form-group row">
                      <label for="lineNumber" class="col-sm-3 col-form-label">Line Number</label>
                      <div class="col-sm-9">
                        <input type="text" class="form-control" id="lineNumber" readonly placeholder="327">
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <div style="display: flex;">
              <div class="card m-3" style="flex: 30%;">
                <div class="card-body">
                  <h5 class="card-title"><span title="Critical" class="badge m-r-5 badge-light-primary">CVSS2</span></h5>
                  <div class="card-text f-18">base score: {{vulnerability.cvssV2BaseScore}}</div>
                  <div class="card-text">cvssV2ImpactSubScore: {{vulnerability.cvssV2ImpactSubScore}}</div>
                  <div class="card-text">cvssV2ExploitabilitySubScore: {{vulnerability.cvssV2ExploitabilitySubScore}}</div>
                  <div class="card-text">cvssV2Vector: {{vulnerability.cvssV2Vector}}</div>
                </div>
                <div class="card-body">
                  <h5 class="card-title"><span title="Critical" class="badge m-r-5 badge-light-success">CVSS3</span></h5>
                  <div class="card-text f-18">base score: {{vulnerability.cvssV3BaseScore}}</div>
                  <div class="card-text">cvssV3ImpactSubScore: {{vulnerability.cvssV3ImpactSubScore}}</div>
                  <div class="card-text">cvssV3ExploitabilitySubScore: {{vulnerability.cvssV3ExploitabilitySubScore}}</div>
                  <div class="card-text">cvssV3Vector: {{vulnerability.cvssV3Vector}}</div>
                </div>
              </div>

              <div class="card m-3" style="flex: 70%;">
                <div class="card-body">
                  <h5 class="card-title">References</h5>
                  <p class="card-text">
                    <markdown>
                      {{vulnerability.references}}
                    </markdown>
                  </p>
                  <!--<p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>-->
                </div>
              </div>
            </div>

            <!-- NPM data -->
            <div style="display: flex;" class="m-3">
              <div class="card m-1" style="flex: 100%;">
                <div class="card-body">
                  <h5 class="card-title"><span title="Critical" class="badge m-r-5 badge-light-primary">NPM DETAILS</span></h5>
                  <div class="card-text f-18">title: {{vulnerability.title}}</div>
                  <div class="card-text">subtitle: {{vulnerability.subtitle}}</div>
                  <div class="card-text">vulnerableVersions: {{vulnerability.vulnerableVersions}}</div>
                  <div class="card-text">patchedVersions: {{vulnerability.patchedVersions}}</div>
                  <div class="card-text">recommendation: {{vulnerability.recommendation}}</div>
                </div>
              </div>
            </div>
          </ng-template>
        </ngb-tab>

        <!-- COMPONENTS TAB -->
        <ngb-tab title="Components" id="components">
          <ng-template ngbTabContent>

            <!-- TAB HEADER -->
            <div style="display: flex;">
              <div class="card m-3">
                <div class="card-body">
                  <h5 class="card-title">
                    Project Components Affected By <span class="badge m-l-5 badge-light-primary">{{vulnerability.vulnId}}</span>
                  </h5>
                </div>
              </div>
            </div>

            <div style="display: flex;">
              <div class="card m-3" style="flex: 50%;flex-grow: 0;" *ngFor="let component of vulnerability.components.edges">
                <div class="card-body">
                  <h6 class="card-title"> {{component.node.group}} : {{component.node.name}}</h6>
                  <div style="display: flex;">
                    <div class="card p-2 m-3" style="flex: 50%;flex-grow: 0;">
                      <form>
                        <div class="form-group row  p-l-5">
                          <label for="currentVer" class="col-sm-12 col-form-label">Current Version</label>
                          <div class="col-xl-12">
                            <input type="text" class="form-control" id="currentVer" readonly placeholder="{{component.node.version}}">
                          </div>
                        </div>
                        <div class="form-group row  p-l-5">
                          <label for="fixVer" class="col-sm-12 col-form-label">Fix Version</label>
                          <div class="col-xl-12">
                            <input type="text" class="form-control" id="fixVer" readonly placeholder="4.3.6">
                          </div>
                        </div>
                      </form>
                    </div>

                    <div style="width:50%;float:right;">
                      <perfect-scrollbar [style.max-height]="'400px'">
                        <p-table #dt [columns]="releaseCols" [value]="releases" [paginator]="false" [rows]="50"
                                 tableStyleClass="table table-striped table-bordered table-hover dataTable no-footer"
                                 [filterDelay]="0" [globalFilterFields]="['version']">

                          <ng-template pTemplate="caption">
                            <div style="text-align: right;float:right;margin-bottom:10px">
                              <input type="text" pInputText size="50" placeholder="Filter"
                                     (input)="dt.filterGlobal($event.target.value, 'contains')"
                                     style="width:160px;display:inline" class="form-control">
                            </div>
                          </ng-template>
                          <ng-template pTemplate="header">
                            <tr>
                              <th>Version</th>
                              <th>Release Date</th>
                            </tr>
                          </ng-template>
                          <ng-template pTemplate="body" let-release>
                            <tr>
                              <td>{{release.version}}</td>
                              <td>{{release.date}}</td>
                            </tr>
                          </ng-template>
                        </p-table>
                      </perfect-scrollbar>
                    </div>

                    <!--
                    <div class="card p-2 m-3" style="flex: 50%;flex-grow: 0;">
                      <perfect-scrollbar [style.max-height]="'250px'">
                        <p-table #dt [value]="vulnerability.components" [paginator]="false" [rows]="50"
                                 tableStyleClass="table table-bordered dataTable no-footer" [autoLayout]="true">

                          <ng-template pTemplate="header">
                            <tr><th>Affected Versions</th></tr>
                          </ng-template>
                          <ng-template pTemplate="body" let-component>
                            <tr><td>4.3.5</td></tr>
                            <tr><td>4.3.4</td></tr>
                            <tr><td>4.3.2</td></tr>
                            <tr><td>4.3.0</td></tr>
                            <tr><td>4.2.0</td></tr>
                            <tr><td>4.1.0</td></tr>
                            <tr><td>4.0.0</td></tr>
                            <tr><td>3.6.0-RC</td></tr>
                          </ng-template>
                        </p-table>
                      </perfect-scrollbar>
                    </div>-->
                  </div>
                </div>
              </div>
            </div>





        <!--
            <perfect-scrollbar [style.max-height]="'650px'">
              <p-table #dt [columns]="componentColumns" [value]="vulnerability.components" [paginator]="false" [rows]="50"
                       tableStyleClass="table table-striped table-bordered table-hover dataTable no-footer"
                       [autoLayout]="true" [globalFilterFields]="['name']">

                <ng-template pTemplate="caption">
                  <div style="display: flex;text-align: left">
                    <div style="flex: 50%;font-weight:bold">

                    </div>
                    <div style="flex: 50%;text-align: right">
                      <i class="pi pi-search" style="margin:4px 4px 0 0"></i>
                      <input type="text" class="form-control" pInputText size="50" placeholder="Global Filter" (input)="dt.filterGlobal($event.target.value, 'contains')" style="width:auto;display:inline">
                    </div>
                  </div>
                </ng-template>
                <ng-template pTemplate="header" let-columns>
                  <tr>
                    <th *ngFor="let col of columns" >
                      {{col}}
                    </th>
                  </tr>
                </ng-template>

                <ng-template pTemplate="body" let-component>
                  <tr [routerLink]="['/dashboard/project/component', component.componentId]">
                    <td>{{component.name}}</td>
                    <td>{{component.group}}</td>
                    <td>{{component.version}}</td>
                    <td>{{component.isInternal}}</td>
                    <td>
                      <span *ngIf="component.licenses">{{component.licenses[0].name}}</span>
                      <span *ngIf="!component.licenses">No License</span>
                    </td>
                    <td>
                      <span title="Critical" class="badge m-r-5 badge-light-danger">45</span>
                      <span title="High" class="badge m-r-5 badge-light-warning">15</span>
                      <span title="Medium" class="badge m-r-5 badge-light-success">11</span>
                      <span title="Low" class="badge m-r-5 badge-light-info">6</span>
                      <span title="Info" class="badge m-r-5 badge-light-primary">6</span>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </perfect-scrollbar>
            -->

          </ng-template>
        </ngb-tab>
        <ngb-tab title="Affected Projects" id="projects">
          <ng-template ngbTabContent>

          </ng-template>
        </ngb-tab>
      </ngb-tabset>
    </div>
  </div>

</div>



