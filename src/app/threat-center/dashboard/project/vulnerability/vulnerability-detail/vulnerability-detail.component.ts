import { Component, Input, OnInit } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import { Observable } from 'rxjs';
import { debounceTime,map,filter,startWith } from 'rxjs/operators';
import {NgbTabChangeEvent} from '@ng-bootstrap/ng-bootstrap';
import { MarkdownModule } from 'ngx-markdown';
import { Scan,License,Vulnerability } from '@app/threat-center/shared/models/types';
import { ApiService,StateService } from '@app/threat-center/shared/services';

@Component({
  selector: 'vulnerability-detail',
  templateUrl: './vulnerability-detail.component.html',
  styles: []
})
export class VulnerabilityDetailComponent implements OnInit {

  obsVulnerability:Observable<Vulnerability>;
  componentColumns = ['Name','Group','Version','Internal','Licenses','Vulnerabilities'];

  constructor(
    private apiService:ApiService,
    private stateService:StateService,
    private route: ActivatedRoute) { }

  ngOnInit() {
    console.log("Loading VulnerabilityDetailComponent");
    let vulnerabilityId = this.route.snapshot.paramMap.get('vulnerabilityId');
    console.log("vulnerabilityId:",vulnerabilityId);
    this.obsVulnerability = this.apiService.getVulnerability(vulnerabilityId)
    .pipe(map(result => result.data.vulnerability));
  }

  onTabChange($event: NgbTabChangeEvent) {
    this.stateService.vulnerability_tabs_selectedTab=$event.nextId;
  }

  public releaseCols = ['Name','Version'];
  public releases = [
      {version:'v4.3.5-RELEASE',date:'05/20/2020'},
      {version:'v4.3.4-RELEASE',date:'05/01/2020'},
      {version:'v4.3.3-RELEASE',date:'04/13/2020'},
      {version:'v4.3.2-RELEASE',date:'04/01/2020'},
      {version:'v4.3.2-RC5',date:'03/02/2020'},
      {version:'v4.3.2-RC4',date:'02/10/2020'},
      {version:'v4.3.2-RC3',date:'01/21/2020'},
      {version:'v4.3.2-RC2',date:'01/01/2020'},
      {version:'v4.3.2-RC1',date:'12/25/2019'},
      {version:'v4.3.1-RELEASE',date:'11/15/2019'},
    ];
}
